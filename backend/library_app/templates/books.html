<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}
    <link rel="stylesheet" href="{% static 'styles/style.css' %}">
    <title>Каталог книг</title>
</head>
<body>
    <header>
        <div class="container">
            <h1 class="header-title">Каталог книг</h1>
            <p class="header_description">Добро пожаловать в интернет-библиотеку! Здесь вы найдёте более 1000 книг в открытом доступе. Бронируйте и читайте бесплатно!</p>
            <form class="books_form" action="{% url 'books_list' %}">
                    <label for="search">Найти книгу по названию, автору, жанру...</label>
                <input type="text" id="search" name="q" placeholder="Введите запрос...">
                <button type="submit">Найти</button>
            </form>
        </div>
    </header>
    <main>
        <div class="container">
            <h2 class="page-title">Каталог книг</h2>
            <a href="{% url 'index' %}" class="btn-catalog">← На главную</a>
            <div class="filters">
                <p><strong>Фильтры:</strong>
                    <a href="?{% if query %}q={{ query }}{% endif %}" {% if not current_genre %}style="font-weight: bold;"{% endif %}>Все</a>
                    {% for g in genres %}
                        <a href="?{% if query %}q={{ query }}&{% endif %}genre={{ g.id }}"
                            {% if current_genre == g.id|stringformat:"s" %}style="font-weight: bold; color: #0a2e5c;"{% endif %}>
                            {{ g.name }}
                        </a>
                    {% endfor %}
                </p>
            </div>
           {% load cache %}
            {% cache 600 books_list_cache request.get_full_path %}
                <ul class="books_list">
                    {% for book in page_obj %}
                    <li class="books_list_item">
                        <div class="book-content">
                            <h3 class="name_book">{{ book.title }}</h3>
                            <p class="class_book">{{ book.author.name }}</p>
                            <p class="date_book">{{ book.year }}</p>
                        </div>
                        <a href="{% url 'book_detail' book.id %}" class="btn-more">Подробнее...</a>
                    </li>
                    {% empty %}
                    <li>Книг не найдено.</li>
                    {% endfor %}
                </ul>
                
                <div class="pagination">
                    {% if page_obj.has_previous %}
                        <a href="?{% if query %}q={{ query }}&{% endif %}{% if current_genre %}genre={{ current_genre }}&{% endif %}page=1">&laquo; Первая</a>
                        <a href="?{% if query %}q={{ query }}&{% endif %}{% if current_genre %}genre={{ current_genre }}&{% endif %}page={{ page_obj.previous_page_number }}">Назад</a>
                    {% endif %}
                    <span>Стр. {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
                    {% if page_obj.has_next %}
                        <a href="?{% if query %}q={{ query }}&{% endif %}{% if current_genre %}genre={{ current_genre }}&{% endif %}page={{ page_obj.next_page_number }}">Вперёд</a>
                        <a href="?{% if query %}q={{ query }}&{% endif %}{% if current_genre %}genre={{ current_genre }}&{% endif %}page={{ page_obj.paginator.num_pages }}">Последняя &raquo;</a>
                    {% endif %}
                </div>
            {% endcache %}
        </div>
    </main>
    <footer>
        <div class="container">
            <div class="contacts">
                <ul class="contact_list">
                    <li>Email: lib111@gmail.com</li>
                    <li>Телефон: +7 (123) 456-78-90</li>
                </ul>
            </div>
            <p class="lib_description">Библиотека №111, читайте с удовольствием</p>
        </div>
    </footer>
</body>
</html>